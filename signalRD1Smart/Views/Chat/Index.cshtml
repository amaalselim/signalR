@{
    ViewData["Title"] = "index";
}

<h1>Chat</h1>
<input type="text" id="message" />
<input type="button" value="send" id="sendmessage" onclick="send()"/>
<br />

<input type="text" id="gtext" />
<input type="button" value="join" onclick="join()" />
<input type="button" value="send to group" onclick="sendgroup()" />


<ul id="ul">
    <li></li>
</ul>

@section Scripts {
    <script src="~/microsoft/signalr/dist/browser/signalr.js"></script>

    <script>
        var nam = prompt("Enter your name: ");

        // define connection, start connection, define function to consume server, callback
        var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();

        connection.serverTimeoutInMilliseconds = 60000; 

        // start connection negotionate between client and server to choose the suitable technique (web socket, server send event, long polling)
        connection.start();
        alert("Connected");

        // call back function
        connection.on("NewMessage", function (name, message) {
            $("#ul").append(`<li>${name} : ${message}</li>`);
           // alert("message broadcast from server");
        });

        connection.on("NewMember", function (name, gname) {
            $("#ul").append(`<li>${name} joinned ${gname }</li>`);
            // alert("message broadcast from server");
        });

        connection.on("groupmsg", function (gname,name, message) {
            $("#ul").append(`<li>${name} ( ${gname} ) : ${message}</li>`);
            // alert("message broadcast from server");
        });

        // fuction to call service
        function send() {
            var message = document.getElementById("message").value;
            connection.invoke("SendMessage", nam, message);
          //alert("message sent to service");
        }

        function join(){
            var gname = document.getElementById("gtext").value;
            connection.invoke("joinGroup", gname, nam);
        }
        function sendgroup() {
            var message = document.getElementById("message").value;
            var gname = document.getElementById("gtext").value;
            connection.invoke("SendToGroup", gname, nam, message);
        }
    </script>
}